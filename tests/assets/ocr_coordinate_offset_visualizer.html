<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR座標ズレ予測</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #fff;
            overflow: hidden;
        }
        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(45deg, #2a2a2a 25%, transparent 25%),
                        linear-gradient(-45deg, #2a2a2a 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #2a2a2a 75%),
                        linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        .test-pattern {
            position: absolute;
            left: 100px;
            top: 50px;
            width: 400px;
            height: 80px;
            background: #ffffff;
            border: 3px solid #00ff00;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #000;
            z-index: 1;
        }
        .label {
            position: absolute;
            background: rgba(0, 255, 0, 0.9);
            color: #000;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: bold;
            border-radius: 3px;
            z-index: 10;
        }
        .label-expected {
            left: 100px;
            top: 30px;
        }
        .selection-expected {
            position: absolute;
            border: 3px dashed #00ff00;
            background: rgba(0, 255, 0, 0.1);
            pointer-events: none;
            z-index: 2;
        }
        .selection-actual {
            position: absolute;
            border: 3px solid #ff0000;
            background: rgba(255, 0, 0, 0.15);
            pointer-events: none;
            z-index: 3;
        }
        .label-actual {
            background: rgba(255, 0, 0, 0.9);
            color: #fff;
        }
        .info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-size: 13px;
            max-width: 350px;
            z-index: 100;
        }
        .info-panel h3 {
            color: #00ff00;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .info-row {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }
        .info-label {
            color: #aaa;
        }
        .info-value {
            color: #fff;
            font-weight: bold;
        }
        .scenario-selector {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff00;
            padding: 15px 25px;
            border-radius: 5px;
            z-index: 100;
        }
        .scenario-selector select {
            background: #2a2a2a;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 15px;
            font-size: 14px;
            border-radius: 3px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
        }
        .offset-arrow {
            position: absolute;
            z-index: 4;
        }
        .arrow-line {
            stroke: #ffff00;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }
        .arrow-label {
            position: absolute;
            background: rgba(255, 255, 0, 0.9);
            color: #000;
            padding: 2px 6px;
            font-size: 11px;
            border-radius: 2px;
            font-weight: bold;
        }
        .legend {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #00ff00;
            padding: 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .legend-box {
            width: 30px;
            height: 15px;
            margin-right: 8px;
            border: 2px solid;
        }
        .legend-expected {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
            border-style: dashed;
        }
        .legend-actual {
            border-color: #ff0000;
            background: rgba(255, 0, 0, 0.15);
        }
    </style>
</head>
<body>
    <div class="container">
        <svg width="0" height="0">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#ffff00" />
                </marker>
            </defs>
        </svg>

        <!-- テストパターン -->
        <div class="test-pattern">
            TEST-A1
        </div>

        <!-- 期待される選択範囲（ユーザーが見ている範囲） -->
        <div class="selection-expected" id="expectedRect"></div>
        <div class="label label-expected">期待座標 (100, 50, 400×80)</div>

        <!-- 実際に選択される範囲（バグによるズレ） -->
        <div class="selection-actual" id="actualRect"></div>
        <div class="label label-actual" id="actualLabel"></div>

        <!-- オフセット矢印 -->
        <svg class="offset-arrow" id="offsetArrow" width="300" height="300">
            <line class="arrow-line" id="arrowLine" x1="0" y1="0" x2="100" y2="100" />
        </svg>
        <div class="arrow-label" id="arrowLabel"></div>

        <!-- 情報パネル -->
        <div class="info-panel">
            <h3>⚠️ 座標ズレ診断</h3>
            <div class="info-row">
                <span class="info-label">シナリオ:</span>
                <span class="info-value" id="infoScenario">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">DPIスケール:</span>
                <span class="info-value" id="infoDpi">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">期待座標:</span>
                <span class="info-value">(100, 50, 400×80)</span>
            </div>
            <div class="info-row">
                <span class="info-label">実測座標:</span>
                <span class="info-value" id="infoActual">-</span>
            </div>
            <div class="info-row">
                <span class="info-label">ズレ量:</span>
                <span class="info-value" id="infoOffset" style="color: #ff0000;">-</span>
            </div>
            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #444; font-size: 11px; color: #aaa;">
                ※緑枠=ユーザーが見て選択した範囲<br>
                ※赤枠=実際にキャプチャされる範囲
            </div>
        </div>

        <!-- シナリオ選択 -->
        <div class="scenario-selector">
            <select id="scenarioSelect">
                <option value="primary_100pct">Primary Monitor @ 100%</option>
                <option value="primary_125pct">Primary Monitor @ 125%</option>
                <option value="secondary_100pct">Secondary Monitor @ 100%</option>
                <option value="secondary_125pct">Secondary Monitor @ 125%</option>
            </select>
        </div>

        <!-- 凡例 -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box legend-expected"></div>
                <span>期待範囲（緑点線）</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-actual"></div>
                <span>実際の範囲（赤実線）</span>
            </div>
        </div>
    </div>

    <script>
        const scenarios = {
            primary_100pct: {
                name: "Primary 100%",
                dpi: 1.25,
                actual: { left: 152, top: 189, width: 495, height: 97 },
                delta: { dx: 52, dy: 139, dw: 95, dh: 17 }
            },
            primary_125pct: {
                name: "Primary 125%",
                dpi: 1.25,
                actual: { left: 193, top: 238, width: 622, height: 123 },
                delta: { dx: 93, dy: 188, dw: 222, dh: 43 }
            },
            secondary_100pct: {
                name: "Secondary 100%",
                dpi: 1.25,
                actual: { left: 150, top: 188, width: 499, height: 98 },
                delta: { dx: 50, dy: 138, dw: 99, dh: 18 }
            },
            secondary_125pct: {
                name: "Secondary 125%",
                dpi: 1.25,
                actual: { left: 191, top: 238, width: 618, height: 119 },
                delta: { dx: 91, dy: 188, dw: 218, dh: 39 }
            }
        };

        const expected = { left: 100, top: 50, width: 400, height: 80 };

        function updateVisualization(scenarioKey) {
            const scenario = scenarios[scenarioKey];
            const actual = scenario.actual;
            const delta = scenario.delta;

            // 期待範囲
            const expectedRect = document.getElementById('expectedRect');
            expectedRect.style.left = `${expected.left}px`;
            expectedRect.style.top = `${expected.top}px`;
            expectedRect.style.width = `${expected.width}px`;
            expectedRect.style.height = `${expected.height}px`;

            // 実際の範囲
            const actualRect = document.getElementById('actualRect');
            actualRect.style.left = `${actual.left}px`;
            actualRect.style.top = `${actual.top}px`;
            actualRect.style.width = `${actual.width}px`;
            actualRect.style.height = `${actual.height}px`;

            // ラベル
            const actualLabel = document.getElementById('actualLabel');
            actualLabel.style.left = `${actual.left}px`;
            actualLabel.style.top = `${actual.top - 25}px`;
            actualLabel.textContent = `実測座標 (${actual.left}, ${actual.top}, ${actual.width}×${actual.height})`;

            // オフセット矢印
            const arrowSvg = document.getElementById('offsetArrow');
            const arrowLine = document.getElementById('arrowLine');
            const startX = expected.left + expected.width / 2;
            const startY = expected.top + expected.height / 2;
            const endX = actual.left + actual.width / 2;
            const endY = actual.top + actual.height / 2;

            arrowSvg.style.left = `${Math.min(startX, endX) - 50}px`;
            arrowSvg.style.top = `${Math.min(startY, endY) - 50}px`;
            arrowSvg.setAttribute('width', Math.abs(endX - startX) + 100);
            arrowSvg.setAttribute('height', Math.abs(endY - startY) + 100);

            const localStartX = startX < endX ? 50 : Math.abs(endX - startX) + 50;
            const localStartY = startY < endY ? 50 : Math.abs(endY - startY) + 50;
            const localEndX = endX < startX ? 50 : Math.abs(endX - startX) + 50;
            const localEndY = endY < startY ? 50 : Math.abs(endY - startY) + 50;

            arrowLine.setAttribute('x1', localStartX);
            arrowLine.setAttribute('y1', localStartY);
            arrowLine.setAttribute('x2', localEndX);
            arrowLine.setAttribute('y2', localEndY);

            // 矢印ラベル
            const arrowLabel = document.getElementById('arrowLabel');
            arrowLabel.style.left = `${(startX + endX) / 2 - 30}px`;
            arrowLabel.style.top = `${(startY + endY) / 2 - 35}px`;
            arrowLabel.textContent = `Δ(${delta.dx > 0 ? '+' : ''}${delta.dx}, ${delta.dy > 0 ? '+' : ''}${delta.dy})`;

            // 情報パネル
            document.getElementById('infoScenario').textContent = scenario.name;
            document.getElementById('infoDpi').textContent = `${scenario.dpi} (常に固定)`;
            document.getElementById('infoActual').textContent = `(${actual.left}, ${actual.top}, ${actual.width}×${actual.height})`;
            document.getElementById('infoOffset').textContent = `(${delta.dx > 0 ? '+' : ''}${delta.dx}, ${delta.dy > 0 ? '+' : ''}${delta.dy}, ${delta.dw > 0 ? '+' : ''}${delta.dw}, ${delta.dh > 0 ? '+' : ''}${delta.dh})`;
        }

        const select = document.getElementById('scenarioSelect');
        select.addEventListener('change', (e) => {
            updateVisualization(e.target.value);
        });

        // 初期表示
        updateVisualization('primary_100pct');

        // F11でフルスクリーン切り替え
        document.addEventListener('keydown', (e) => {
            if (e.key === 'F11') {
                e.preventDefault();
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
        });
    </script>
</body>
</html>
