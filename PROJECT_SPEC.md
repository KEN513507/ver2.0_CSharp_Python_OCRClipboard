# OCR Clipboard v2.0 開発仕様

## 概要
- C#（WinUI3）＋Pythonの二層構成
- 10秒以内・誤差≤4文字の品質制約
- テスト画像セット（A1〜E1）・期待語句は test_cases.json に準拠

---

## DFD（Data Flow Diagram）

### レベル0（コンテキスト図）

```
┌────────────┐           ┌──────────────┐
│    ユーザー   │──操作──▶│  Capture/OCR  │──テキスト→クリップボード/保存
└────────────┘           └──────────────┘
         ▲                         │
         └────ログ/結果の確認───────┘
```

- システム境界内に C# フロントエンド（WinUI3）と Python OCR バックエンド。
- 出力はクリップボード貼り付け or ファイル保存、ログ記録。

### レベル1（モジュール分解）

```
[外部] ユーザー
   │ Hotkey
   ▼
┌────────────────────────────────────────────────────────────────────────────┐
│             C# Frontend (WinUI3) & Native Capture                         │
│                                                                            │
│ P1 ホットキー監視 ──▶ P2 モニタ特定 ──▶ P3 オーバーレイ&矩形選択             │
│     │設定読込(D1)         │(GetCursorPos/MonitorFromPoint)                 │
│     ▼                     ▼                                                │
│ P4 モニタキャプチャ(Windows.Graphics.Capture) ─▶ P5 前処理/切抜              │
│                                          │                                 │
│                                          ├─▶ D3 画像キャッシュ               │
│                                          ▼                                 │
│                             P6 OCRディスパッチ(IPC: NamedPipe/gRPC)        │
│                                          │                                 │
│                                          ▼                                 │
│                             Python Backend (yomitoku 等)                    │
│                             P7 推論 → P8 後処理(正規化/半全角/句読点)         │
│                                          │                                 │
│                                          ├─▶ D4 結果ログ/品質 (JSON/CSV)     │
│                                          └─▶ P9 出力(Clipboard/保存)         │
└────────────────────────────────────────────────────────────────────────────┘
                       ▲                 ▲
                       │                 │
                   D1 設定/プリセット   D2 テストケース(期待語句/正解) ← テスト時のみ使用
```

#### 各プロセスの要点と10秒制約配分（上限例）

- **P2/P3**（モニタ特定・選択UI）：~1.0s（UI描画は即時）
- **P4/P5**（キャプチャ・前処理）：~0.8s（GPU→GPUクロップ、2×拡大/Grayなど）
- **P6/P7**（IPC＋推論）：~7.5s（モデル初期化はウォームアップ、以降キャッシュ）
- **P8**（正規化/半全角/ダッシュ統一）：~0.3s
- **P9**（出力＋ログ）：~0.2s
  ※ 合計 9.8s 以内を目安。超過時はデグレード（小モデル/解像度下げ）へフェイルセーフ。

---

# 追加仕様・注意点
- DFD/ER図・品質基準・テストケースは本ファイルに随時追記
- 仕様変更・課題・運用ルールもここに記載
