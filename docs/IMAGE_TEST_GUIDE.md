# 📸 画像ファイルベースOCRテスト実施ガイド

## 🎯 目的

このガイドでは、**実際のスクリーンショット画像**を使用してOCR性能を検証する方法を説明します。

従来のベンチマークは理想的条件（人工的なテキスト、白背景）でのテストであり、実際の使用状況を反映していませんでした。このテスト方法では、**実際のWebページや文書のスクリーンショット**を使用して、現実的な性能評価を行います。

---

## 📋 準備するもの

### 1. テスト画像（スクリーンショット）

以下の条件でスクリーンショットを撮影してください：

| 項目 | 推奨設定 | 必須条件 |
|------|---------|---------|
| **DPIスケーリング** | 100% | ✅ **必須** |
| **ディスプレイ** | Display 1（プライマリモニター） | ✅ **必須** |
| **画像形式** | PNG または JPG | ✅ 必須 |
| **コンテンツ** | 実際のWebページ、PDF、文書など | 推奨 |
| **文字数** | 100文字〜2000文字 | テスト目的に応じて |

⚠️ **重要:** DPIスケーリングが125%や150%の場合、座標補正が正しく動作しない可能性があります。

### 2. 期待テキストファイル（オプション）

- スクリーンショットに含まれる**正確なテキスト**をコピーしてテキストファイルに保存
- ファイル名は画像ファイル名と対応させる（例: `sample.png` → `sample.txt`）
- エンコーディング: UTF-8（推奨）

---

## 📂 ディレクトリ構造

```
test_images/
├── QUICK_START.md               # クイックスタートガイド
├── sample_100chars.png          # 100文字程度のスクリーンショット
├── sample_100chars.txt          # 期待テキスト（オプション）
├── sample_500chars.png          # 500文字程度のスクリーンショット
├── sample_500chars.txt
├── sample_1000chars.png         # 1000文字程度のスクリーンショット
├── sample_1000chars.txt
└── sample_2000chars.png         # 2000文字（H0棄却テスト用）
    └── sample_2000chars.txt
```

---

## 🛠 テスト実施手順

### ステップ 1: テスト画像の準備

#### 1.1 DPIスケーリングを100%に設定

1. Windowsの設定を開く
2. **システム** → **ディスプレイ**
3. **拡大縮小とレイアウト** → **100%** を選択
4. PCを再起動（推奨）

#### 1.2 スクリーンショットを撮影

**方法A: Snipping Tool（推奨）**
```
1. Snipping Toolを起動
2. 「新規」をクリック
3. テストしたい文書・Webページの領域を選択
4. PNGまたはJPG形式で保存
```

**方法B: PrintScreenキー**
```
1. テストしたい画面を表示
2. PrintScreenキーを押す
3. ペイントなどで開いて必要な領域を切り取り
4. test_images/ ディレクトリに保存
```

#### 1.3 期待テキストの準備（オプション）

```
1. スクリーンショットしたコンテンツからテキストをコピー
2. メモ帳などのテキストエディタに貼り付け
3. UTF-8形式で test_images/<画像名>.txt として保存
```

### ステップ 2: テスト実行

#### 2.1 基本テスト（OCR精度のみ確認）

```pwsh
# 期待テキストなしでOCR実行（認識結果のみ表示）
dotnet run --project src\csharp\OCRClipboard.App -- --test-image test_images/sample_100chars.png
```

**出力例:**
```
📁 画像読み込み: test_images/sample_100chars.png
📐 画像サイズ: 800x600
🔄 5回のOCR実行を開始...

[1/5] 実行中...
  処理時間: 1234.5 ms
  認識テキスト文字数: 102

[2/5] 実行中...
  処理時間: 1189.2 ms
  認識テキスト文字数: 102

... (省略)

📊 統計結果:
  平均処理時間: 1200.3 ms
  最小処理時間: 1189.2 ms
  最大処理時間: 1250.1 ms
```

#### 2.2 完全テスト（OCR精度 + H0棄却判定）

```pwsh
# 期待テキストありでOCR精度を計算
dotnet run --project src\csharp\OCRClipboard.App -- --test-image test_images/sample_100chars.png test_images/sample_100chars.txt
```

**出力例:**
```
📁 画像読み込み: test_images/sample_100chars.png
📄 期待テキスト読み込み: test_images/sample_100chars.txt (105文字)
📐 画像サイズ: 800x600
🔄 5回のOCR実行を開始...

[1/5] 実行中...
  処理時間: 1234.5 ms
  認識テキスト文字数: 102
  一致率: 97.1%

[2/5] 実行中...
  処理時間: 1189.2 ms
  認識テキスト文字数: 103
  一致率: 98.1%

... (省略)

📊 統計結果:
  平均処理時間: 1200.3 ms  (範囲: 1189.2 - 1250.1 ms)
  平均精度: 97.6%  (範囲: 96.2% - 98.1%)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🧪 H0仮説検定
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
H0: 識字率 >= 95% かつ 処理時間 < 10,000ms

判定基準:
  ⏱️  最大処理時間: 1250.1 ms < 10,000 ms ✅
  📈 最小精度: 96.2% >= 95.0% ✅

🟢 結論: H0を受容
   → OCR性能は要求水準を満たしています
```

### ステップ 3: テストケースの作成

#### 3.1 軽量テスト（100-500文字）

**目的:** 基本的なOCR機能の動作確認

```pwsh
# 準備
1. 100-500文字程度の日本語テキストが含まれるWebページを開く
2. スクリーンショットを撮影 → test_images/light_test.png
3. テキストをコピー → test_images/light_test.txt

# 実行
dotnet run --project src\csharp\OCRClipboard.App -- --test-image test_images/light_test.png test_images/light_test.txt
```

**期待結果:**
- ✅ 処理時間: < 3,000 ms
- ✅ 精度: >= 95%
- ✅ H0受容

#### 3.2 中量テスト（500-1000文字）

**目的:** 実用的な文書でのOCR性能確認

```pwsh
# 準備
1. 500-1000文字程度の日本語文書（ニュース記事、ブログ等）を開く
2. スクリーンショットを撮影 → test_images/medium_test.png
3. テキストをコピー → test_images/medium_test.txt

# 実行
dotnet run --project src\csharp\OCRClipboard.App -- --test-image test_images/medium_test.png test_images/medium_test.txt
```

**期待結果:**
- ✅ 処理時間: < 5,000 ms
- ✅ 精度: >= 95%
- ✅ H0受容

#### 3.3 重量テスト（1000-2000文字）

**目的:** 性能限界の確認（H0棄却テスト）

```pwsh
# 準備
1. 1000-2000文字程度の長文（Wikipedia記事等）を開く
2. スクリーンショットを撮影 → test_images/heavy_test.png
3. テキストをコピー → test_images/heavy_test.txt

# 実行
dotnet run --project src\csharp\OCRClipboard.App -- --test-image test_images/heavy_test.png test_images/heavy_test.txt
```

**期待結果（H0棄却の可能性）:**
- ⚠️ 処理時間: >= 10,000 ms（10秒以上）
- ⚠️ 精度: < 95%
- 🔴 H0棄却 → 性能要求を満たさない

---

## 📊 テスト計画テンプレート

### テストケース1: 基本動作確認

| 項目 | 内容 |
|------|------|
| **テスト名** | 基本OCR動作確認 |
| **画像** | `test_images/basic_100.png` |
| **文字数** | 約100文字 |
| **期待テキスト** | `test_images/basic_100.txt` |
| **期待処理時間** | < 2,000 ms |
| **期待精度** | >= 95% |
| **H0判定** | 受容 |

**実行コマンド:**
```pwsh
dotnet run --project src\csharp\OCRClipboard.App -- --test-image test_images/basic_100.png test_images/basic_100.txt
```

---

### テストケース2: 実用性能確認

| 項目 | 内容 |
|------|------|
| **テスト名** | 実用的文書でのOCR性能 |
| **画像** | `test_images/practical_500.png` |
| **文字数** | 約500文字 |
| **期待テキスト** | `test_images/practical_500.txt` |
| **期待処理時間** | < 5,000 ms |
| **期待精度** | >= 95% |
| **H0判定** | 受容 |

**実行コマンド:**
```pwsh
dotnet run --project src\csharp\OCRClipboard.App -- --test-image test_images/practical_500.png test_images/practical_500.txt
```

---

### テストケース3: 性能限界確認（H0棄却テスト）

| 項目 | 内容 |
|------|------|
| **テスト名** | 大量テキストでの性能限界 |
| **画像** | `test_images/stress_2000.png` |
| **文字数** | 約2000文字 |
| **期待テキスト** | `test_images/stress_2000.txt` |
| **期待処理時間** | >= 10,000 ms（棄却条件） |
| **期待精度** | < 95%（棄却条件） |
| **H0判定** | **棄却**（性能限界を超える） |

**実行コマンド:**
```pwsh
dotnet run --project src\csharp\OCRClipboard.App -- --test-image test_images/stress_2000.png test_images/stress_2000.txt
```

**期待出力（H0棄却）:**
```
🔴 結論: H0を棄却
   理由: 処理時間が基準を超過 (12,345 ms >= 10,000 ms)
   → OCR性能は要求水準を満たしていません
```

---

## 🔍 トラブルシューティング

### Q1: DPIスケーリングを変更できない

**A:** 以下を確認してください：
- 管理者権限でログインしているか
- ディスプレイドライバーが最新か
- マルチモニター環境の場合、正しいディスプレイを選択しているか

### Q2: スクリーンショットが真っ黒になる

**A:** 以下を試してください：
- 別のスクリーンショットツールを使用（Snipping Tool → PrintScreen）
- 対象アプリケーションのハードウェアアクセラレーションを無効化
- ウィンドウモードで撮影（フルスクリーンモード避ける）

### Q3: OCR精度が極端に低い（< 50%）

**A:** 以下を確認してください：
- 画像が鮮明か（ぼやけていないか）
- 文字サイズが小さすぎないか（最低10pt推奨）
- 背景とテキストのコントラストが十分か
- 画像ファイルが破損していないか

### Q4: 処理時間が異常に長い（> 30秒）

**A:** 以下を確認してください：
- 画像サイズが大きすぎないか（推奨: 1920x1080以下）
- CPUリソースが他のプロセスに占有されていないか
- Windows Media OCRエンジンが正しくインストールされているか

---

## 📝 テスト結果の記録

テスト実施後、以下の形式で結果を記録することを推奨します：

```markdown
# OCRテスト結果レポート

## テスト環境
- 実施日: 2025-11-01
- OS: Windows 11
- DPIスケーリング: 100%
- ディスプレイ解像度: 1920x1080

## テストケース1: 基本動作確認
- 画像: test_images/basic_100.png
- 文字数: 102文字
- 平均処理時間: 1,234 ms
- 平均精度: 97.5%
- H0判定: ✅ 受容

## テストケース2: 実用性能確認
- 画像: test_images/practical_500.png
- 文字数: 512文字
- 平均処理時間: 4,567 ms
- 平均精度: 96.2%
- H0判定: ✅ 受容

## テストケース3: 性能限界確認
- 画像: test_images/stress_2000.png
- 文字数: 2,048文字
- 平均処理時間: 12,345 ms
- 平均精度: 93.1%
- H0判定: 🔴 棄却（処理時間超過）

## 結論
- 軽量〜中量テキスト（100-1000文字）: 性能要求を満たす
- 重量テキスト（2000文字以上）: 性能限界を超える
- 推奨使用範囲: 1000文字以下
```

---

## 🚀 次のステップ

1. **テスト画像を3つ準備**
   - 100文字、500文字、1000文字のスクリーンショット
   
2. **基本テスト実行**
   - 各画像でOCRテストを実行
   
3. **結果分析**
   - どの文字数でH0が棄却されるか確認
   
4. **性能改善検討**
   - H0棄却された場合、改善策を検討（エンジン変更、並列処理など）

---

## 📚 関連ドキュメント

- **[test_images/QUICK_START.md](../test_images/QUICK_START.md)** - すぐ試せるクイックスタート
- **[README.md](../README.md)** - プロジェクト全体の説明
- **[BENCHMARK.md](BENCHMARK.md)** - ベンチマーク結果

---

**最終更新:** 2025-11-01  
**作成者:** OCRClipboard開発チーム
